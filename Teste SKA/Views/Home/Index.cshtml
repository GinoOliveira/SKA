<div class="container" >
    <div class="row" id="divBody">
        <div class="col-sm-12 col-md-5 col-12"  id="divInput">
            <h1>To do list</h1>
            <form>
               <div id="divForm">
                    <label>Titulo</label>
                    <input id="inputTituloTarefa" class="col-sm-10 col-md-8 col-8" type="text" />
               </div>
                <div id="divForm">
                    <label>Descrição</label>
                    <input id="inputDescricaoTarefa" class="col-sm-10 col-md-8 col-8" type="text" />
                    <img src="~/images/mais.png" onclick="InputTarefa()" />
               </div>
            </form>
        </div>
        <ul id="divUl">
        </ul>
   </div>
</div>


<script>

    function InputTarefa() {
        let inputTituloTarefa = $("#inputTituloTarefa").val()
        let inputDescricaoTarefa = $("#inputDescricaoTarefa").val()
        $("#inputTituloTarefa").val('')
        $("#inputDescricaoTarefa").val('')
            $.ajax({
                method: "POST",
                dataType: 'json',
                contentType: 'application/json',
            url: "@(Url.Action("AdicionarTarefa", "Tarefa"))",
                data: JSON.stringify({
                    titulo: inputTituloTarefa,
                    descricao: inputDescricaoTarefa
                }),
                success: function (data) {
                BuscarTarefas()
                },
                error: function (params) {
                    console.log("error")
                    console.log(params)
                }
            });
        
    }
    BuscarTarefas()
    function BuscarTarefas() {
        $.ajax({
            method: "GET",
            dataType: 'json',
            contentType: 'application/json',
            url: "@(Url.Action("GetTarefas", "Tarefa"))",
            data: JSON.stringify({
                titulo: inputTituloTarefa,
                descricao: inputDescricaoTarefa
            }),
            success: function (data) {
                console.log(data)
                $("#divUl").html(` <ul id="divUl"></ul>`)
                for (let i = 0; i < data.length; i++) {
                    if (data[i].concluida == true) {
                        $("#divUl").append(` <li class="col-sm-12 col-12 col-md-5" id="divTask"><input  class="form-check-input" type="checkbox" value="" onchange="ConcluirTarefa(${data[i].id})" checked id="flexCheckDefault">${data[i].titulo} - ${data[i].descricao}<img src="images/lixeira.png" onclick="DeletarTarefa(${data[i].id})" /></li>`)
                    }else{
                        $("#divUl").append(` <li class="col-sm-12 col-12 col-md-5" id="divTask"><input  class="form-check-input" type="checkbox" value="" onchange="ConcluirTarefa(${data[i].id})" id="flexCheckDefault">${data[i].titulo} - ${data[i].descricao}<img src="images/lixeira.png" onclick="DeletarTarefa(${data[i].id})" /></li>`)
                    }
                    
                }
            },
            error: function (params) {
                console.log("error")
                console.log(params)
            }
        });
    }

    function DeletarTarefa(id){
        console.log(id)
        $.ajax({
            url: "/api/Tarefa/RemoverTarefa/" + id,
            type: "DELETE",
            success: function (data) {
                BuscarTarefas()
            },
            error: function (xhr, status, error) {
                console.log("Erro ao remover tarefa:", status, error);
            }
        });
    }

    function ConcluirTarefa(id) {
        console.log(id)
        $.ajax({
            url: "/api/Tarefa/MarcarConcluida/" + id,
            type: "POST",
            success: function (data) {
                BuscarTarefas()
            },
            error: function (xhr, status, error) {
                console.log("Erro ao remover tarefa:", status, error);
            }
        });
    }

</script>